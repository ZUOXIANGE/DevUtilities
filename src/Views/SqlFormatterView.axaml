<UserControl xmlns="https://github.com/avaloniaui"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:vm="using:DevUtilities.ViewModels"
             xmlns:converters="using:DevUtilities.Converters"
             x:Class="DevUtilities.Views.SqlFormatterView"
             x:DataType="vm:SqlFormatterViewModel">

  <ScrollViewer>
    <StackPanel Spacing="24" Margin="24">
      
      <!-- 标题区域 -->
      <StackPanel Spacing="8">
        <TextBlock Text="SQL格式化器" 
                   FontSize="28" 
                   FontWeight="Bold" 
                   Foreground="{DynamicResource SystemAccentColor}"/>
        <TextBlock Text="格式化、压缩和验证SQL查询语句" 
                   FontSize="14" 
                   Foreground="{DynamicResource TextFillColorSecondaryBrush}"/>
      </StackPanel>
      
      <!-- 控制面板 -->
      <Border Background="{DynamicResource CardBackgroundFillColorDefaultBrush}"
              CornerRadius="12"
              Padding="24"
              BoxShadow="0 2 8 0 #10000000">
        <StackPanel Spacing="20">
          <TextBlock Text="格式化选项" FontWeight="SemiBold" FontSize="18"/>
          
          <Grid ColumnDefinitions="*,*,*" RowDefinitions="Auto,Auto" RowSpacing="16" ColumnSpacing="20">
            <!-- 第一行选项 -->
            <StackPanel Grid.Column="0" Spacing="8">
              <TextBlock Text="SQL方言" FontWeight="SemiBold"/>
              <ComboBox ItemsSource="{Binding AvailableDialects}"
                        SelectedItem="{Binding SelectedDialect}"
                        HorizontalAlignment="Stretch"/>
            </StackPanel>

            <StackPanel Grid.Column="1" Spacing="8">
              <TextBlock Text="缩进大小" FontWeight="SemiBold"/>
              <NumericUpDown Value="{Binding IndentSize}" 
                             Minimum="1" 
                             Maximum="8" 
                             HorizontalAlignment="Stretch"/>
            </StackPanel>

            <StackPanel Grid.Column="2" Spacing="8">
              <TextBlock Text="格式选项" FontWeight="SemiBold"/>
              <CheckBox Content="关键字大写" IsChecked="{Binding UppercaseKeywords}"/>
            </StackPanel>

            <!-- 第二行选项 -->
            <CheckBox Grid.Row="1" Grid.Column="0" 
                      Content="添加换行符" 
                      IsChecked="{Binding AddLineBreaks}"/>
            
            <CheckBox Grid.Row="1" Grid.Column="1" 
                      Content="对齐列名" 
                      IsChecked="{Binding AlignColumns}"/>
          </Grid>
        </StackPanel>
      </Border>

      <!-- 操作按钮区域 -->
      <Border Background="{DynamicResource CardBackgroundFillColorDefaultBrush}"
              CornerRadius="12"
              Padding="20"
              BoxShadow="0 2 8 0 #10000000">
        <StackPanel Orientation="Horizontal" Spacing="12" HorizontalAlignment="Center">
          <Button Content="格式化" 
                  Command="{Binding FormatCommand}"
                  Classes="accent"
                  Padding="24,12"
                  FontWeight="SemiBold"
                  ToolTip.Tip="格式化SQL (Ctrl+F)"/>
          <Button Content="压缩" 
                  Command="{Binding CompressCommand}"
                  Padding="24,12"
                  FontWeight="SemiBold"
                  ToolTip.Tip="压缩SQL (Ctrl+M)"/>
          <Button Content="验证" 
                  Command="{Binding ValidateCommand}"
                  Padding="24,12"
                  FontWeight="SemiBold"
                  ToolTip.Tip="验证SQL (Ctrl+V)"/>
          <Button Content="交换" 
                  Command="{Binding SwapInputOutputCommand}"
                  Padding="24,12"
                  FontWeight="SemiBold"
                  ToolTip.Tip="交换输入输出 (Ctrl+S)"/>
          <Button Content="示例" 
                  Command="{Binding UseExampleCommand}"
                  Padding="24,12"
                  FontWeight="SemiBold"
                  ToolTip.Tip="使用示例 (Ctrl+E)"/>
          <Button Content="清空" 
                  Command="{Binding ClearCommand}"
                  Padding="24,12"
                  FontWeight="SemiBold"
                  ToolTip.Tip="清空所有内容 (Ctrl+L)"/>
          <Button Content="复制" 
                  Command="{Binding CopyCommand}"
                  Classes="accent"
                  Padding="24,12"
                  FontWeight="SemiBold"
                  ToolTip.Tip="复制输出 (Ctrl+C)"/>
        </StackPanel>
      </Border>

      <!-- 验证消息区域 -->
      <Border Background="{Binding IsValid, Converter={x:Static converters:BooleanToColorConverter.Instance}}"
              CornerRadius="8"
              Padding="16"
              BoxShadow="0 2 4 0 #10000000"
              IsVisible="{Binding ValidationMessage, Converter={x:Static converters:StringIsNotNullOrEmptyConverter.Instance}}">
        <StackPanel Orientation="Horizontal" Spacing="12">
          <TextBlock Text="🔍" FontSize="16" VerticalAlignment="Center"/>
          <TextBlock Text="{Binding ValidationMessage}"
                     FontWeight="Medium"
                     VerticalAlignment="Center"
                     TextWrapping="Wrap"/>
        </StackPanel>
      </Border>

      <!-- 输入输出区域 -->
      <Grid ColumnDefinitions="*,24,*" RowDefinitions="Auto,*" RowSpacing="16">
        
        <!-- 输入区域标题 -->
        <StackPanel Grid.Column="0" Grid.Row="0" Spacing="8">
          <TextBlock Text="输入SQL" 
                     FontWeight="SemiBold" 
                     FontSize="18"/>
          <TextBlock Text="在此输入需要格式化的SQL语句" 
                     FontSize="12" 
                     Foreground="{DynamicResource TextFillColorSecondaryBrush}"/>
        </StackPanel>
        
        <!-- 输出区域标题 -->
        <StackPanel Grid.Column="2" Grid.Row="0" Spacing="8">
          <TextBlock Text="格式化结果" 
                     FontWeight="SemiBold" 
                     FontSize="18"/>
          <TextBlock Text="格式化后的SQL将显示在这里" 
                     FontSize="12" 
                     Foreground="{DynamicResource TextFillColorSecondaryBrush}"/>
        </StackPanel>

        <!-- 输入区域 -->
        <Border Grid.Column="0" Grid.Row="1" 
                Background="{DynamicResource CardBackgroundFillColorDefaultBrush}"
                CornerRadius="12"
                Padding="20"
                MinHeight="400"
                BoxShadow="0 2 8 0 #10000000">
          <ScrollViewer HorizontalScrollBarVisibility="Auto" VerticalScrollBarVisibility="Auto">
            <TextBox Text="{Binding InputText}"
                     AcceptsReturn="True"
                     TextWrapping="NoWrap"
                     FontFamily="JetBrains Mono,Consolas,Monaco,monospace"
                     FontSize="14"
                     Background="Transparent"
                     BorderThickness="0"
                     LineHeight="20"
                     Watermark="请输入SQL语句..."/>
          </ScrollViewer>
        </Border>

        <!-- 输出区域 -->
        <Border Grid.Column="2" Grid.Row="1" 
                Background="{DynamicResource CardBackgroundFillColorDefaultBrush}"
                CornerRadius="12"
                Padding="20"
                MinHeight="400"
                BoxShadow="0 2 8 0 #10000000">
          <ScrollViewer HorizontalScrollBarVisibility="Auto" VerticalScrollBarVisibility="Auto">
            <SelectableTextBlock Text="{Binding OutputText}"
                                 FontFamily="JetBrains Mono,Consolas,Monaco,monospace"
                                 FontSize="14"
                                 TextWrapping="NoWrap"
                                 LineHeight="20"/>
          </ScrollViewer>
        </Border>
      </Grid>

      <!-- 使用说明区域 -->
      <Border Background="{DynamicResource CardBackgroundFillColorDefaultBrush}"
              CornerRadius="12"
              Padding="24"
              BoxShadow="0 2 8 0 #10000000">
        <StackPanel Spacing="16">
          <StackPanel Orientation="Horizontal" Spacing="12">
            <TextBlock Text="💡" FontSize="20" VerticalAlignment="Center"/>
            <TextBlock Text="使用说明" FontWeight="SemiBold" FontSize="18" VerticalAlignment="Center"/>
          </StackPanel>
          <TextBlock TextWrapping="Wrap" 
                     FontSize="14" 
                     LineHeight="22"
                     Foreground="{DynamicResource TextFillColorSecondaryBrush}">
            • 格式化：美化SQL语句，添加适当的缩进和换行，提高可读性
            • 压缩：移除多余的空白字符，生成紧凑的SQL语句
            • 验证：检查SQL语法的基本正确性和结构问题
            • 支持多种SQL方言：Standard SQL、MySQL、PostgreSQL、SQL Server、Oracle、SQLite
            • 可自定义缩进大小、关键字大小写、换行和列对齐选项
            • 支持复杂查询语句的格式化，包括子查询、联接和函数
          </TextBlock>
        </StackPanel>
      </Border>

      <!-- 示例SQL -->
      <Expander Header="SQL示例" IsExpanded="False">
        <Border Background="{DynamicResource LayerFillColorDefaultBrush}"
                CornerRadius="5"
                Padding="15">
          <StackPanel Spacing="10">
            <TextBlock Text="📝 复杂查询示例" FontWeight="SemiBold"/>
            <TextBox Text="SELECT u.id, u.name, u.email, p.title, p.content, c.name as category FROM users u LEFT JOIN posts p ON u.id = p.user_id INNER JOIN categories c ON p.category_id = c.id WHERE u.status = 'active' AND p.published_at > '2023-01-01' ORDER BY p.published_at DESC, u.name ASC LIMIT 10;"
                     IsReadOnly="True"
                     FontFamily="Consolas"
                     FontSize="11"
                     TextWrapping="Wrap"
                     Background="{DynamicResource SubtleFillColorSecondaryBrush}"
                     Padding="10"/>
          </StackPanel>
        </Border>
      </Expander>

    </StackPanel>
  </ScrollViewer>

</UserControl>