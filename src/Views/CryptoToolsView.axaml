<UserControl xmlns="https://github.com/avaloniaui"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
             xmlns:vm="using:DevUtilities.ViewModels"
             mc:Ignorable="d" d:DesignWidth="800" d:DesignHeight="450"
             x:Class="DevUtilities.Views.CryptoToolsView"
             x:DataType="vm:CryptoToolsViewModel">
  <ScrollViewer VerticalAlignment="Stretch" HorizontalAlignment="Stretch" VerticalScrollBarVisibility="Auto" HorizontalScrollBarVisibility="Auto">
    <StackPanel Margin="20" Spacing="20">
      <!-- 标题 -->
      <SelectableTextBlock Text="加密解密工具" 
                 FontSize="24" 
                 FontWeight="Bold" 
                 HorizontalAlignment="Center"/>

      <!-- 错误信息 -->
      <Border Background="#FFEBEE" CornerRadius="4" Padding="12" 
              IsVisible="{Binding ValidationMessage, Converter={x:Static StringConverters.IsNotNullOrEmpty}}">
        <SelectableTextBlock Text="{Binding ValidationMessage}" 
                   Foreground="#C62828" 
                   TextWrapping="Wrap"/>
      </Border>

      <!-- 算法选择 -->
      <Border Background="White" CornerRadius="8" Padding="16" BorderBrush="#E0E0E0" BorderThickness="1">
        <StackPanel Spacing="16">
          <TextBlock Text="加密算法设置" FontWeight="Bold" FontSize="16"/>
          
          <Grid>
            <Grid.ColumnDefinitions>
              <ColumnDefinition Width="*"/>
              <ColumnDefinition Width="*"/>
              <ColumnDefinition Width="*"/>
              <ColumnDefinition Width="*"/>
            </Grid.ColumnDefinitions>
            <Grid.RowDefinitions>
              <RowDefinition Height="Auto"/>
              <RowDefinition Height="Auto"/>
            </Grid.RowDefinitions>
            
            <!-- Headers -->
            <SelectableTextBlock Grid.Row="0" Grid.Column="0" Text="算法" FontWeight="SemiBold" Margin="4"/>
            <SelectableTextBlock Grid.Row="0" Grid.Column="1" Text="模式" FontWeight="SemiBold" Margin="4"/>
            <SelectableTextBlock Grid.Row="0" Grid.Column="2" Text="填充" FontWeight="SemiBold" Margin="4"/>
            <SelectableTextBlock Grid.Row="0" Grid.Column="3" Text="编码" FontWeight="SemiBold" Margin="4"/>
            
            <!-- Dropdowns -->
            <ComboBox Grid.Row="1" Grid.Column="0" 
                      SelectedItem="{Binding SelectedAlgorithm}"
                      Margin="4">
              <ComboBoxItem Content="AES"/>
              <ComboBoxItem Content="DES"/>
              <ComboBoxItem Content="3DES"/>
              <ComboBoxItem Content="RC4"/>
            </ComboBox>
            
            <ComboBox Grid.Row="1" Grid.Column="1" 
                      SelectedItem="{Binding SelectedMode}"
                      Margin="4">
              <ComboBoxItem Content="CBC"/>
              <ComboBoxItem Content="ECB"/>
              <ComboBoxItem Content="CFB"/>
              <ComboBoxItem Content="OFB"/>
            </ComboBox>
            
            <ComboBox Grid.Row="1" Grid.Column="2" 
                      SelectedItem="{Binding SelectedPadding}"
                      Margin="4">
              <ComboBoxItem Content="PKCS7"/>
              <ComboBoxItem Content="None"/>
              <ComboBoxItem Content="Zeros"/>
            </ComboBox>
            
            <ComboBox Grid.Row="1" Grid.Column="3" 
                      SelectedItem="{Binding SelectedEncoding}"
                      Margin="4">
              <ComboBoxItem Content="UTF-8"/>
              <ComboBoxItem Content="ASCII"/>
              <ComboBoxItem Content="Unicode"/>
              <ComboBoxItem Content="Base64"/>
              <ComboBoxItem Content="Hex"/>
            </ComboBox>
          </Grid>
        </StackPanel>
      </Border>

      <!-- 密钥和IV设置 -->
      <Border Background="White" CornerRadius="8" Padding="16" BorderBrush="#E0E0E0" BorderThickness="1">
        <StackPanel Spacing="16">
          <TextBlock Text="密钥设置" FontWeight="Bold" FontSize="16"/>
          
          <Grid>
            <Grid.ColumnDefinitions>
              <ColumnDefinition Width="*"/>
              <ColumnDefinition Width="Auto"/>
            </Grid.ColumnDefinitions>
            <Grid.RowDefinitions>
              <RowDefinition Height="Auto"/>
              <RowDefinition Height="Auto"/>
              <RowDefinition Height="Auto"/>
              <RowDefinition Height="Auto"/>
            </Grid.RowDefinitions>
            
            <SelectableTextBlock Grid.Row="0" Grid.Column="0" Text="密钥 (Key)" FontWeight="SemiBold" Margin="0,0,0,4"/>
            
            <TextBox Grid.Row="1" Grid.Column="0" Grid.ColumnSpan="2"
                     Text="{Binding KeyText}" 
                     Watermark="输入密钥（十六进制格式）"
                     FontFamily="Consolas"/>
            
            <SelectableTextBlock Grid.Row="2" Grid.Column="0" Text="初始化向量 (IV)" FontWeight="SemiBold" Margin="0,8,0,4"/>
            
            <TextBox Grid.Row="3" Grid.Column="0" Grid.ColumnSpan="2"
                     Text="{Binding IvText}" 
                     Watermark="输入IV（十六进制格式，可选）"
                     FontFamily="Consolas"/>
          </Grid>
        </StackPanel>
      </Border>

      <!-- 输入输出区域 -->
      <Grid>
        <Grid.ColumnDefinitions>
          <ColumnDefinition Width="*"/>
          <ColumnDefinition Width="Auto"/>
          <ColumnDefinition Width="*"/>
        </Grid.ColumnDefinitions>
        
        <!-- 输入区域 -->
        <Border Grid.Column="0" Background="White" CornerRadius="8" Padding="16" BorderBrush="#E0E0E0" BorderThickness="1">
          <StackPanel Spacing="12">
            <SelectableTextBlock Text="输入文本" FontWeight="Bold" FontSize="16"/>
            
            <TextBox Text="{Binding InputText}" 
                     AcceptsReturn="True" 
                     TextWrapping="Wrap" 
                     Height="200" 
                     ScrollViewer.VerticalScrollBarVisibility="Auto"
                     Watermark="输入要加密或解密的文本" />
            
            <StackPanel Orientation="Horizontal" Spacing="8">
              <Button Content="从文件加载" Command="{Binding EncryptCommand}"/>
              <Button Content="清空" Command="{Binding ClearAllCommand}"/>
            </StackPanel>
          </StackPanel>
        </Border>
        
        <!-- 操作按钮 -->
        <StackPanel Grid.Column="1" Spacing="12" Margin="16,20,16,0" VerticalAlignment="Center">
          <Button Content="加密" 
                  Command="{Binding EncryptCommand}" 
                  Width="100"
                  Height="40"
                  FontWeight="Bold"/>
          <Button Content="解密" 
                  Command="{Binding DecryptCommand}" 
                  Width="100"
                  Height="40"
                  FontWeight="Bold"/>
          <Button Content="交换" 
                  Command="{Binding SwapInputOutputCommand}" 
                  Width="100"/>
        </StackPanel>
        
        <!-- 输出区域 -->
        <Border Grid.Column="2" Background="White" CornerRadius="8" Padding="16" BorderBrush="#E0E0E0" BorderThickness="1">
          <StackPanel Spacing="12">
            <SelectableTextBlock Text="输出结果" FontWeight="Bold" FontSize="16"/>
            
            <TextBox Text="{Binding OutputText}" 
                     AcceptsReturn="True" 
                     TextWrapping="Wrap" 
                     Height="200" 
                     ScrollViewer.VerticalScrollBarVisibility="Auto"
                     IsReadOnly="True"
                     Background="#F8F9FA"/>
            
            <StackPanel Orientation="Horizontal" Spacing="8">
              <Button Content="复制结果" Command="{Binding CopyOutputCommand}"/>
              <Button Content="保存到文件" Command="{Binding ClearAllCommand}"/>
              <Button Content="清空" Command="{Binding ClearAllCommand}"/>
            </StackPanel>
          </StackPanel>
        </Border>
      </Grid>

      <!-- 哈希工具 -->
      <Border Background="White" CornerRadius="8" Padding="16" BorderBrush="#E0E0E0" BorderThickness="1">
        <StackPanel Spacing="16">
          <SelectableTextBlock Text="哈希工具" FontWeight="Bold" FontSize="16"/>
          
          <Grid>
            <Grid.ColumnDefinitions>
              <ColumnDefinition Width="Auto"/>
              <ColumnDefinition Width="*"/>
              <ColumnDefinition Width="Auto"/>
            </Grid.ColumnDefinitions>
            
            <SelectableTextBlock Grid.Column="0" Text="算法：" VerticalAlignment="Center" Margin="0,0,8,0"/>
            
            <ComboBox Grid.Column="1" 
                      SelectedItem="{Binding SelectedHashAlgorithm}"
                      Margin="0,0,8,0">
              <ComboBoxItem Content="MD5"/>
              <ComboBoxItem Content="SHA1"/>
              <ComboBoxItem Content="SHA256"/>
              <ComboBoxItem Content="SHA384"/>
              <ComboBoxItem Content="SHA512"/>
            </ComboBox>
            
            <Button Grid.Column="2" Content="计算哈希" Command="{Binding ComputeHashCommand}"/>
          </Grid>
          
          <TextBox Text="{Binding HashOutput}" 
                   IsReadOnly="True"
                   FontFamily="Consolas"
                   Background="#F8F9FA"
                   Watermark="哈希结果将显示在这里"/>
        </StackPanel>
      </Border>

      <!-- 使用说明 -->
      <Expander Header="使用说明" IsExpanded="False">
        <StackPanel Spacing="12" Margin="10">
          <SelectableTextBlock Text="加密算法说明" FontWeight="SemiBold"/>
          <StackPanel Spacing="4" Margin="10,0">
            <SelectableTextBlock Text="• AES：高级加密标准，安全性高，推荐使用"/>
            <SelectableTextBlock Text="• DES：数据加密标准，安全性较低，不推荐"/>
            <SelectableTextBlock Text="• 3DES：三重DES，安全性中等"/>
            <SelectableTextBlock Text="• RC4：流加密算法，速度快但安全性有争议"/>
          </StackPanel>
          
          <SelectableTextBlock Text="加密模式说明" FontWeight="SemiBold" Margin="0,10,0,0"/>
          <StackPanel Spacing="4" Margin="10,0">
            <SelectableTextBlock Text="• CBC：密码块链接模式，需要IV，安全性高"/>
            <SelectableTextBlock Text="• ECB：电子密码本模式，不需要IV，安全性低"/>
            <SelectableTextBlock Text="• CFB：密码反馈模式，需要IV"/>
            <SelectableTextBlock Text="• OFB：输出反馈模式，需要IV"/>
          </StackPanel>
          
          <SelectableTextBlock Text="填充模式说明" FontWeight="SemiBold" Margin="0,10,0,0"/>
          <StackPanel Spacing="4" Margin="10,0">
            <SelectableTextBlock Text="• PKCS7：标准填充模式，推荐使用"/>
            <SelectableTextBlock Text="• None：无填充，数据长度必须是块大小的倍数"/>
            <SelectableTextBlock Text="• Zeros：零填充"/>
          </StackPanel>
          
          <SelectableTextBlock Text="使用提示" FontWeight="SemiBold" Margin="0,10,0,0"/>
          <StackPanel Spacing="4" Margin="10,0">
            <SelectableTextBlock Text="• 密钥长度：AES支持128/192/256位，DES为64位，3DES为192位"/>
            <SelectableTextBlock Text="• IV长度：通常与算法块大小相同（AES为128位，DES为64位）"/>
            <SelectableTextBlock Text="• 加密前请确保密钥和IV的长度正确"/>
            <SelectableTextBlock Text="• 解密时必须使用相同的算法、模式、填充和密钥"/>
          </StackPanel>
        </StackPanel>
      </Expander>
    </StackPanel>
  </ScrollViewer>
</UserControl>

