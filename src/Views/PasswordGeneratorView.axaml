<UserControl xmlns="https://github.com/avaloniaui"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:vm="using:DevUtilities.ViewModels"
             x:Class="DevUtilities.Views.PasswordGeneratorView"
             x:DataType="vm:PasswordGeneratorViewModel">

  <Design.DataContext>
    <vm:PasswordGeneratorViewModel/>
  </Design.DataContext>

  <ScrollViewer>
    <StackPanel Margin="20" Spacing="20">
      
      <!-- 标题区域 -->
      <StackPanel Spacing="6">
        <SelectableTextBlock Text="密码生成器" 
                   FontSize="26" 
                   FontWeight="Bold" 
                   Foreground="{DynamicResource SystemAccentColor}"/>
        <SelectableTextBlock Text="生成安全可靠的密码，支持多种自定义选项" 
                   FontSize="14" 
                   Foreground="{DynamicResource SystemControlForegroundBaseMediumBrush}"/>
      </StackPanel>

      <!-- 密码生成区域 -->
      <Border Background="{DynamicResource SystemControlBackgroundAltHighBrush}" 
              CornerRadius="8" 
              Padding="16">
        <StackPanel Spacing="12">
          <SelectableTextBlock Text="生成的密码" FontWeight="SemiBold" FontSize="16"/>
          
          <Grid ColumnDefinitions="*,Auto,Auto,Auto">
            <TextBox Grid.Column="0" 
                    Text="{Binding GeneratedPassword}" 
                    IsReadOnly="True"
                    FontFamily="Consolas,Monaco,monospace"
                    FontSize="16"
                    Padding="12"
                    Background="{DynamicResource SystemControlBackgroundBaseLowBrush}"
                    Margin="0,0,8,0"/>
            
            <Button Grid.Column="1" 
                   Content="复制" 
                   Command="{Binding CopyPasswordCommand}"
                   Margin="0,0,4,0"/>
            
            <Button Grid.Column="2" 
                   Content="生成" 
                   Command="{Binding GeneratePasswordCommand}"
                   Classes="accent"
                   Margin="0,0,4,0"/>
            
            <Button Grid.Column="3" 
                   Content="清空" 
                   Command="{Binding GeneratePasswordCommand}"/>
          </Grid>
          
          <!-- 密码强度指示器 -->
          <StackPanel Spacing="4">
            <SelectableTextBlock Text="密码强度" FontWeight="SemiBold"/>
            <Grid ColumnDefinitions="*,Auto">
              <ProgressBar Grid.Column="0" 
                          Value="{Binding StrengthScore}" 
                          Maximum="100"
                          Height="8"
                          CornerRadius="4"
                          Margin="0,0,8,0"/>
              <SelectableTextBlock Grid.Column="1" 
                        Text="{Binding PasswordStrength}" 
                        FontWeight="SemiBold"
                        Foreground="{Binding StrengthColor}"/>
            </Grid>
          </StackPanel>
        </StackPanel>
      </Border>

      <!-- 密码设置区域 -->
      <Border Background="{DynamicResource SystemControlBackgroundAltHighBrush}" 
              CornerRadius="8" 
              Padding="16">
        <StackPanel Spacing="12">
          <TextBlock Text="密码设置" FontWeight="SemiBold" FontSize="16"/>
          
          <!-- 密码长度 -->
          <Grid ColumnDefinitions="Auto,*,Auto" RowDefinitions="Auto,Auto">
            <SelectableTextBlock Grid.Column="0" Grid.Row="0" 
                      Text="密码长度:" 
                      VerticalAlignment="Center" 
                      Margin="0,0,12,0"/>
            
            <Slider Grid.Column="1" Grid.Row="0"
                   Value="{Binding PasswordLength}" 
                   Minimum="4" 
                   Maximum="128"
                   TickFrequency="1"
                   IsSnapToTickEnabled="True"
                   Margin="0,0,12,0"/>
            
            <TextBox Grid.Column="2" Grid.Row="0"
                    Text="{Binding PasswordLength}" 
                    Width="60"
                    HorizontalContentAlignment="Center"/>
            
            <SelectableTextBlock Grid.Column="0" Grid.ColumnSpan="3" Grid.Row="1"
                      Text="{Binding PasswordLength, StringFormat='当前长度: {0} 个字符'}"
                      FontSize="12"
                      Foreground="{DynamicResource SystemControlForegroundBaseMediumBrush}"
                      Margin="0,4,0,0"/>
          </Grid>
          
          <!-- 字符类型选择 -->
          <SelectableTextBlock Text="包含字符类型" FontWeight="SemiBold" Margin="0,8,0,0"/>
          
          <Grid ColumnDefinitions="*,*" RowDefinitions="Auto,Auto,Auto,Auto">
            <CheckBox Grid.Column="0" Grid.Row="0" 
                     IsChecked="{Binding IncludeUppercase}" 
                     Content="大写字母 (A-Z)" 
                     Margin="0,0,0,8"/>
            
            <CheckBox Grid.Column="1" Grid.Row="0" 
                     IsChecked="{Binding IncludeLowercase}" 
                     Content="小写字母 (a-z)" 
                     Margin="0,0,0,8"/>
            
            <CheckBox Grid.Column="0" Grid.Row="1" 
                     IsChecked="{Binding IncludeNumbers}" 
                     Content="数字 (0-9)" 
                     Margin="0,0,0,8"/>
            
            <CheckBox Grid.Column="1" Grid.Row="1" 
                     IsChecked="{Binding IncludeSymbols}" 
                     Content="特殊符号 (!@#$%^&amp;*)" 
                     Margin="0,0,0,8"/>
            
            <CheckBox Grid.Column="0" Grid.Row="2" 
                     IsChecked="{Binding ExcludeSimilar}" 
                     Content="排除相似字符 (0,O,l,1)" 
                     Margin="0,0,0,8"/>
            
            <CheckBox Grid.Column="1" Grid.Row="2" 
                     IsChecked="{Binding ExcludeAmbiguous}" 
                     Content="排除易混淆字符" 
                     Margin="0,0,0,8"/>
          </Grid>
          
          <!-- 自定义字符 -->
          <StackPanel Spacing="8">
            <CheckBox IsChecked="{Binding UseCustomCharacters}" 
                     Content="使用自定义字符集"/>
            
            <TextBox Text="{Binding CustomCharacters}" 
                    Watermark="输入自定义字符..."
                    IsEnabled="{Binding UseCustomCharacters}"
                    FontFamily="Consolas,Monaco,monospace"/>
          </StackPanel>
        </StackPanel>
      </Border>

      <!-- 批量生成区域 -->
      <Border Background="{DynamicResource SystemControlBackgroundAltHighBrush}" 
              CornerRadius="8" 
              Padding="16">
        <StackPanel Spacing="12">
          <SelectableTextBlock Text="批量生成" FontWeight="SemiBold" FontSize="16"/>
          
          <Grid ColumnDefinitions="Auto,*,Auto,Auto">
            <SelectableTextBlock Grid.Column="0" 
                      Text="生成数量:" 
                      VerticalAlignment="Center" 
                      Margin="0,0,8,0"/>
            
            <TextBox Grid.Column="1" 
                    Text="{Binding BatchCount}" 
                    Width="80"
                    Margin="0,0,8,0"/>
            
            <Button Grid.Column="2" 
                   Content="批量生成" 
                   Command="{Binding GenerateBatchCommand}"
                   Margin="0,0,4,0"/>
            
            <Button Grid.Column="3" 
                   Content="导出列表" 
                   Command="{Binding GenerateBatchCommand}"
                   IsEnabled="{Binding GeneratedPasswords.Count}"/>
          </Grid>
          
          <!-- 生成的密码列表 -->
          <Border Background="{DynamicResource SystemControlBackgroundBaseLowBrush}" 
                  CornerRadius="6" 
                  Padding="8"
                  MaxHeight="200"
                  IsVisible="{Binding GeneratedPasswords.Count}">
            <ScrollViewer>
              <ItemsControl ItemsSource="{Binding GeneratedPasswords}">
                <ItemsControl.ItemTemplate>
                  <DataTemplate>
                    <Border Background="{DynamicResource SystemControlBackgroundAltLowBrush}" 
                            CornerRadius="4" 
                            Padding="8" 
                            Margin="0,2">
                      <Grid ColumnDefinitions="*,Auto">
                        <SelectableTextBlock Grid.Column="0" 
                                  Text="{Binding}" 
                                  FontFamily="Consolas,Monaco,monospace"
                                  VerticalAlignment="Center"/>
                        <Button Grid.Column="1" 
                               Content="复制" 
                               Command="{Binding $parent[ItemsControl].DataContext.CopyPasswordCommand}"
                               CommandParameter="{Binding}"
                               Classes="small"/>
                      </Grid>
                    </Border>
                  </DataTemplate>
                </ItemsControl.ItemTemplate>
              </ItemsControl>
            </ScrollViewer>
          </Border>
        </StackPanel>
      </Border>

      <!-- 密码历史记录 -->
      <Border Background="{DynamicResource SystemControlBackgroundAltHighBrush}" 
              CornerRadius="8" 
              Padding="16">
        <StackPanel Spacing="12">
          <Grid ColumnDefinitions="*,Auto,Auto">
            <SelectableTextBlock Grid.Column="0" 
                      Text="密码历史" 
                      FontWeight="SemiBold" 
                      FontSize="16"
                      VerticalAlignment="Center"/>
            
            <Button Grid.Column="1" 
                   Content="清空历史" 
                   Command="{Binding ClearHistoryCommand}"
                   Margin="0,0,4,0"/>
            
            <Button Grid.Column="2" 
                   Content="导出历史" 
                   Command="{Binding ClearHistoryCommand}"
                   IsEnabled="{Binding PasswordHistory.Count}"/>
          </Grid>
          
          <Border Background="{DynamicResource SystemControlBackgroundBaseLowBrush}" 
                  CornerRadius="6" 
                  Padding="8"
                  MaxHeight="150"
                  IsVisible="{Binding PasswordHistory.Count}">
            <ScrollViewer>
              <ItemsControl ItemsSource="{Binding PasswordHistory}">
                <ItemsControl.ItemTemplate>
                  <DataTemplate>
                    <Border Background="{DynamicResource SystemControlBackgroundAltLowBrush}" 
                            CornerRadius="4" 
                            Padding="8" 
                            Margin="0,2">
                      <Grid ColumnDefinitions="*,Auto,Auto">
                        <SelectableTextBlock Grid.Column="0" 
                                  Text="{Binding}" 
                                  FontFamily="Consolas,Monaco,monospace"
                                  VerticalAlignment="Center"/>
                        
                        <Button Grid.Column="1" 
                               Content="复制" 
                               Command="{Binding $parent[ItemsControl].DataContext.CopyPasswordCommand}"
                               CommandParameter="{Binding}"
                               Classes="small"
                               Margin="4,0"/>
                        
                        <Button Grid.Column="2" 
                               Content="删除" 
                               Command="{Binding $parent[ItemsControl].DataContext.ClearHistoryCommand}"
                               Classes="small"/>
                      </Grid>
                    </Border>
                  </DataTemplate>
                </ItemsControl.ItemTemplate>
              </ItemsControl>
            </ScrollViewer>
          </Border>
          
          <SelectableTextBlock Text="暂无密码历史记录" 
                    HorizontalAlignment="Center"
                    Foreground="{DynamicResource SystemControlForegroundBaseMediumBrush}"
                    IsVisible="{Binding !PasswordHistory.Count}"/>
        </StackPanel>
      </Border>

      <!-- 快速预设 -->
      <Border Background="{DynamicResource SystemControlBackgroundAltHighBrush}" 
              CornerRadius="8" 
              Padding="16">
        <StackPanel Spacing="12">
          <SelectableTextBlock Text="快速预设" FontWeight="SemiBold" FontSize="16"/>
          
          <WrapPanel Orientation="Horizontal" HorizontalAlignment="Center">
            <!-- 预设功能暂时移除，因为ViewModel中没有对应的命令 -->
          </WrapPanel>
        </StackPanel>
      </Border>

      <!-- 密码安全提示 -->
      <Expander Header="密码安全提示" IsExpanded="False">
        <Border Background="{DynamicResource SystemControlBackgroundAltHighBrush}" 
                CornerRadius="8" 
                Padding="16">
          <StackPanel Spacing="8">
            <SelectableTextBlock Text="密码强度建议：" FontWeight="SemiBold"/>
            <SelectableTextBlock Text="• 至少12个字符长度" TextWrapping="Wrap"/>
            <SelectableTextBlock Text="• 包含大小写字母、数字和特殊符号" TextWrapping="Wrap"/>
            <SelectableTextBlock Text="• 避免使用个人信息或常见词汇" TextWrapping="Wrap"/>
            <SelectableTextBlock Text="• 不同账户使用不同密码" TextWrapping="Wrap"/>
            
            <SelectableTextBlock Text="使用建议：" FontWeight="SemiBold" Margin="0,12,0,0"/>
            <SelectableTextBlock Text="• 定期更换重要账户密码" TextWrapping="Wrap"/>
            <SelectableTextBlock Text="• 使用密码管理器存储密码" TextWrapping="Wrap"/>
            <SelectableTextBlock Text="• 启用双因素认证增强安全性" TextWrapping="Wrap"/>
            <SelectableTextBlock Text="• 避免在公共场所输入密码" TextWrapping="Wrap"/>
          </StackPanel>
        </Border>
      </Expander>

    </StackPanel>
  </ScrollViewer>
</UserControl>

