<UserControl xmlns="https://github.com/avaloniaui"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:vm="using:DevUtilities.ViewModels"
             x:Class="DevUtilities.Views.PasswordGeneratorView"
             x:DataType="vm:PasswordGeneratorViewModel">

  <ScrollViewer>
    <StackPanel Spacing="20" Margin="20">
      
      <!-- 标题 -->
      <TextBlock Text="密码生成器" 
                 FontSize="24" 
                 FontWeight="Bold" 
                 Foreground="{DynamicResource SystemAccentColor}"/>
      
      <!-- 控制面板 -->
      <Border Background="{DynamicResource CardBackgroundFillColorDefaultBrush}"
              CornerRadius="8"
              Padding="20">
        <Grid RowDefinitions="Auto,20,Auto,20,Auto,20,Auto" ColumnDefinitions="*,20,*">
          
          <!-- 密码长度 -->
          <StackPanel Grid.Row="0" Grid.Column="0" Spacing="8">
            <TextBlock Text="密码长度" FontWeight="SemiBold"/>
            <Grid ColumnDefinitions="*,10,Auto">
              <Slider Grid.Column="0" 
                      Minimum="4" 
                      Maximum="128" 
                      Value="{Binding PasswordLength}"
                      TickFrequency="8"
                      IsSnapToTickEnabled="True"/>
              <TextBox Grid.Column="2" 
                       Text="{Binding PasswordLength}" 
                       Width="60"
                       HorizontalContentAlignment="Center"/>
            </Grid>
          </StackPanel>

          <!-- 批量生成数量 -->
          <StackPanel Grid.Row="0" Grid.Column="2" Spacing="8">
            <TextBlock Text="批量生成数量" FontWeight="SemiBold"/>
            <Grid ColumnDefinitions="*,10,Auto">
              <Slider Grid.Column="0" 
                      Minimum="1" 
                      Maximum="50" 
                      Value="{Binding BatchCount}"
                      TickFrequency="5"
                      IsSnapToTickEnabled="True"/>
              <TextBox Grid.Column="2" 
                       Text="{Binding BatchCount}" 
                       Width="60"
                       HorizontalContentAlignment="Center"/>
            </Grid>
          </StackPanel>

          <!-- 字符类型选择 -->
          <StackPanel Grid.Row="2" Grid.Column="0" Grid.ColumnSpan="3" Spacing="12">
            <TextBlock Text="字符类型" FontWeight="SemiBold"/>
            <WrapPanel>
              <CheckBox Content="大写字母 (A-Z)" 
                        IsChecked="{Binding IncludeUppercase}" 
                        Margin="0,0,20,8"/>
              <CheckBox Content="小写字母 (a-z)" 
                        IsChecked="{Binding IncludeLowercase}" 
                        Margin="0,0,20,8"/>
              <CheckBox Content="数字 (0-9)" 
                        IsChecked="{Binding IncludeNumbers}" 
                        Margin="0,0,20,8"/>
              <CheckBox Content="符号 (!@#$%^&amp;*)" 
                        IsChecked="{Binding IncludeSymbols}" 
                        Margin="0,0,20,8"/>
            </WrapPanel>
          </StackPanel>

          <!-- 排除选项 -->
          <StackPanel Grid.Row="4" Grid.Column="0" Grid.ColumnSpan="3" Spacing="12">
            <TextBlock Text="排除选项" FontWeight="SemiBold"/>
            <WrapPanel>
              <CheckBox Content="排除相似字符 (il1Lo0O)" 
                        IsChecked="{Binding ExcludeSimilar}" 
                        Margin="0,0,20,8"/>
              <CheckBox Content="排除模糊字符 ({}[]/\)" 
                        IsChecked="{Binding ExcludeAmbiguous}" 
                        Margin="0,0,20,8"/>
            </WrapPanel>
          </StackPanel>

          <!-- 自定义字符 -->
          <StackPanel Grid.Row="6" Grid.Column="0" Grid.ColumnSpan="3" Spacing="12">
            <CheckBox Content="使用自定义字符集" 
                      IsChecked="{Binding UseCustomCharacters}" 
                      FontWeight="SemiBold"/>
            <TextBox Text="{Binding CustomCharacters}" 
                     Watermark="输入自定义字符..."
                     IsEnabled="{Binding UseCustomCharacters}"/>
          </StackPanel>

        </Grid>
      </Border>

      <!-- 生成的密码 -->
      <Border Background="{DynamicResource CardBackgroundFillColorDefaultBrush}"
              CornerRadius="8"
              Padding="20">
        <StackPanel Spacing="15">
          <Grid ColumnDefinitions="*,Auto">
            <TextBlock Grid.Column="0" 
                       Text="生成的密码" 
                       FontWeight="SemiBold" 
                       FontSize="16"/>
            <StackPanel Grid.Column="1" Orientation="Horizontal" Spacing="10">
              <Button Content="生成新密码" 
                      Command="{Binding GeneratePasswordCommand}"
                      Classes="accent"/>
              <Button Content="复制" 
                      Command="{Binding CopyPasswordCommand}"/>
            </StackPanel>
          </Grid>

          <Border Background="{DynamicResource ControlFillColorDefaultBrush}"
                  CornerRadius="4"
                  Padding="12">
            <SelectableTextBlock Text="{Binding GeneratedPassword}" 
                                 FontFamily="Consolas,Monaco,monospace"
                                 FontSize="14"
                                 TextWrapping="Wrap"/>
          </Border>

          <!-- 密码强度 -->
          <Grid ColumnDefinitions="Auto,10,*,10,Auto" IsVisible="{Binding GeneratedPassword, Converter={x:Static StringConverters.IsNotNullOrEmpty}}">
            <TextBlock Grid.Column="0" Text="强度:" VerticalAlignment="Center"/>
            <ProgressBar Grid.Column="2" 
                         Value="{Binding StrengthScore}" 
                         Maximum="100"
                         Height="8"
                         CornerRadius="4"
                         Foreground="{Binding StrengthColor}"/>
            <TextBlock Grid.Column="4" 
                       Text="{Binding PasswordStrength}" 
                       Foreground="{Binding StrengthColor}"
                       FontWeight="SemiBold"
                       VerticalAlignment="Center"/>
          </Grid>
        </StackPanel>
      </Border>

      <!-- 批量生成 -->
      <Border Background="{DynamicResource CardBackgroundFillColorDefaultBrush}"
              CornerRadius="8"
              Padding="20">
        <StackPanel Spacing="15">
          <Grid ColumnDefinitions="*,Auto">
            <TextBlock Grid.Column="0" 
                       Text="批量生成" 
                       FontWeight="SemiBold" 
                       FontSize="16"/>
            <Button Grid.Column="1" 
                    Content="批量生成" 
                    Command="{Binding GenerateBatchCommand}"/>
          </Grid>

          <ScrollViewer MaxHeight="200" IsVisible="{Binding GeneratedPasswords.Count}">
            <ItemsControl ItemsSource="{Binding GeneratedPasswords}">
              <ItemsControl.ItemTemplate>
                <DataTemplate>
                  <Border Background="{DynamicResource ControlFillColorDefaultBrush}"
                          CornerRadius="4"
                          Padding="8"
                          Margin="0,2">
                    <SelectableTextBlock Text="{Binding}" 
                                         FontFamily="Consolas,Monaco,monospace"
                                         FontSize="12"/>
                  </Border>
                </DataTemplate>
              </ItemsControl.ItemTemplate>
            </ItemsControl>
          </ScrollViewer>
        </StackPanel>
      </Border>

      <!-- 历史记录 -->
      <Border Background="{DynamicResource CardBackgroundFillColorDefaultBrush}"
              CornerRadius="8"
              Padding="20"
              IsVisible="{Binding PasswordHistory.Count}">
        <StackPanel Spacing="15">
          <Grid ColumnDefinitions="*,Auto">
            <TextBlock Grid.Column="0" 
                       Text="历史记录" 
                       FontWeight="SemiBold" 
                       FontSize="16"/>
            <Button Grid.Column="1" 
                    Content="清空历史" 
                    Command="{Binding ClearHistoryCommand}"/>
          </Grid>

          <ScrollViewer MaxHeight="200">
            <ItemsControl ItemsSource="{Binding PasswordHistory}">
              <ItemsControl.ItemTemplate>
                <DataTemplate>
                  <Button Background="{DynamicResource ControlFillColorDefaultBrush}"
                          CornerRadius="4"
                          Padding="8"
                          Margin="0,2"
                          HorizontalContentAlignment="Stretch"
                          Command="{Binding $parent[UserControl].((vm:PasswordGeneratorViewModel)DataContext).UseHistoryPasswordCommand}" 
                          CommandParameter="{Binding}">
                    <SelectableTextBlock Text="{Binding}" 
                                         FontFamily="Consolas,Monaco,monospace"
                                         FontSize="12"/>
                  </Button>
                </DataTemplate>
              </ItemsControl.ItemTemplate>
            </ItemsControl>
          </ScrollViewer>
        </StackPanel>
      </Border>

      <!-- 使用说明 -->
      <Border Background="{DynamicResource CardBackgroundFillColorDefaultBrush}"
              CornerRadius="8"
              Padding="20">
        <StackPanel Spacing="10">
          <TextBlock Text="使用说明" FontWeight="SemiBold" FontSize="16"/>
          <TextBlock TextWrapping="Wrap" Foreground="{DynamicResource TextFillColorSecondaryBrush}">
            • 调整密码长度和选择字符类型来生成安全密码
            • 可以排除相似或模糊字符以提高可读性
            • 支持自定义字符集进行特殊需求的密码生成
            • 实时显示密码强度评估
            • 支持批量生成多个密码
            • 点击历史记录中的密码可以重新使用
          </TextBlock>
        </StackPanel>
      </Border>

    </StackPanel>
  </ScrollViewer>

</UserControl>