<UserControl xmlns="https://github.com/avaloniaui"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
             xmlns:vm="using:DevUtilities.ViewModels"
             xmlns:converters="using:DevUtilities.Converters"
             mc:Ignorable="d" d:DesignWidth="800" d:DesignHeight="600"
             x:Class="DevUtilities.Views.CronExpressionView"
             x:DataType="vm:CronExpressionViewModel">

  <ScrollViewer>
    <StackPanel Margin="24" Spacing="20">
      
      <!-- Cron Expression Input -->
      <Border Background="White" CornerRadius="8" Padding="16" BorderBrush="#E0E0E0" BorderThickness="1">
        <StackPanel Spacing="16">
          <TextBlock Text="Cron表达式" FontWeight="Bold" FontSize="16"/>
          
          <Grid>
            <Grid.ColumnDefinitions>
              <ColumnDefinition Width="*"/>
              <ColumnDefinition Width="Auto"/>
            </Grid.ColumnDefinitions>
            
            <TextBox Grid.Column="0" 
                     Text="{Binding CronExpression}" 
                     Watermark="输入Cron表达式，例如：0 0 12 * * ?"
                     FontFamily="Consolas,Monaco,monospace"/>
            
            <StackPanel Grid.Column="1" Orientation="Horizontal" Spacing="8" Margin="8,0,0,0">
              <Button Content="解析" Classes="primary-button" Command="{Binding ParseExpressionCommand}"/>
              <Button Content="清空" Classes="secondary-button" Command="{Binding ClearCommand}"/>
            </StackPanel>
          </Grid>
          
          <!-- Validation Message -->
          <Border Background="LightCoral" 
                  CornerRadius="4" 
                  Padding="8" 
                  Margin="0,8,0,0"
                  IsVisible="{Binding ValidationMessage, Converter={x:Static converters:StringConverters.IsNotNullOrEmpty}}">
            <TextBlock Text="{Binding ValidationMessage}" 
                       Foreground="White" 
                       FontWeight="SemiBold"/>
          </Border>

          <!-- Description -->
          <Border Background="LightGreen" 
                  CornerRadius="4" 
                  Padding="8" 
                  Margin="0,8,0,0"
                  IsVisible="{Binding Description, Converter={x:Static converters:StringConverters.IsNotNullOrEmpty}}">
            <TextBlock Text="{Binding Description}" 
                       Foreground="DarkGreen" 
                       FontWeight="SemiBold"/>
          </Border>
        </StackPanel>
      </Border>

      <!-- Preset Expressions -->
      <Border Background="White" CornerRadius="8" Padding="16" BorderBrush="#E0E0E0" BorderThickness="1">
        <StackPanel Spacing="16">
          <TextBlock Text="常用表达式" FontWeight="Bold" FontSize="16"/>
          
          <ItemsControl ItemsSource="{Binding PresetExpressions}">
            <ItemsControl.ItemsPanel>
              <ItemsPanelTemplate>
                <WrapPanel Orientation="Horizontal"/>
              </ItemsPanelTemplate>
            </ItemsControl.ItemsPanel>
            <ItemsControl.ItemTemplate>
              <DataTemplate>
                <Button Content="{Binding Key}" 
                        Classes="preset-button"
                        Command="{Binding $parent[UserControl].((vm:CronExpressionViewModel)DataContext).UsePresetCommand}"
                        CommandParameter="{Binding Key}"
                        Margin="4,2"
                        Padding="12,6"/>
              </DataTemplate>
            </ItemsControl.ItemTemplate>
          </ItemsControl>
        </StackPanel>
      </Border>

      <!-- Visual Builder -->
      <Border Background="White" CornerRadius="8" Padding="16" BorderBrush="#E0E0E0" BorderThickness="1">
        <StackPanel Spacing="16">
          <TextBlock Text="可视化构建器" FontWeight="Bold" FontSize="16"/>
          
          <Grid>
            <Grid.ColumnDefinitions>
              <ColumnDefinition Width="*"/>
              <ColumnDefinition Width="*"/>
              <ColumnDefinition Width="*"/>
              <ColumnDefinition Width="*"/>
              <ColumnDefinition Width="*"/>
              <ColumnDefinition Width="*"/>
            </Grid.ColumnDefinitions>
            <Grid.RowDefinitions>
              <RowDefinition Height="Auto"/>
              <RowDefinition Height="Auto"/>
            </Grid.RowDefinitions>
            
            <!-- Headers -->
            <TextBlock Grid.Row="0" Grid.Column="0" Text="秒" HorizontalAlignment="Center" FontWeight="Bold"/>
            <TextBlock Grid.Row="0" Grid.Column="1" Text="分" HorizontalAlignment="Center" FontWeight="Bold"/>
            <TextBlock Grid.Row="0" Grid.Column="2" Text="时" HorizontalAlignment="Center" FontWeight="Bold"/>
            <TextBlock Grid.Row="0" Grid.Column="3" Text="日" HorizontalAlignment="Center" FontWeight="Bold"/>
            <TextBlock Grid.Row="0" Grid.Column="4" Text="月" HorizontalAlignment="Center" FontWeight="Bold"/>
            <TextBlock Grid.Row="0" Grid.Column="5" Text="周" HorizontalAlignment="Center" FontWeight="Bold"/>
            
            <!-- Selectors -->
            <ComboBox Grid.Row="1" Grid.Column="0" 
                      ItemsSource="{Binding SecondOptions}" 
                      SelectedItem="{Binding SelectedSecond}"
                      Margin="4"/>
            <ComboBox Grid.Row="1" Grid.Column="1" 
                      ItemsSource="{Binding MinuteOptions}" 
                      SelectedItem="{Binding SelectedMinute}"
                      Margin="4"/>
            <ComboBox Grid.Row="1" Grid.Column="2" 
                      ItemsSource="{Binding HourOptions}" 
                      SelectedItem="{Binding SelectedHour}"
                      Margin="4"/>
            <ComboBox Grid.Row="1" Grid.Column="3" 
                      ItemsSource="{Binding DayOptions}" 
                      SelectedItem="{Binding SelectedDay}"
                      Margin="4"/>
            <ComboBox Grid.Row="1" Grid.Column="4" 
                      ItemsSource="{Binding MonthOptions}" 
                      SelectedItem="{Binding SelectedMonth}"
                      Margin="4"/>
            <ComboBox Grid.Row="1" Grid.Column="5" 
                      ItemsSource="{Binding WeekOptions}" 
                      SelectedItem="{Binding SelectedWeek}"
                      Margin="4"/>
          </Grid>
          
          <Button Content="生成表达式" 
                  Classes="primary-button" 
                  Command="{Binding GenerateExpressionCommand}"
                  HorizontalAlignment="Center"/>
        </StackPanel>
      </Border>

      <!-- Description and Next Executions -->
      <Grid>
        <Grid.ColumnDefinitions>
          <ColumnDefinition Width="*"/>
          <ColumnDefinition Width="*"/>
        </Grid.ColumnDefinitions>
        
        <!-- Description -->
        <Border Grid.Column="0" Background="White" CornerRadius="8" Padding="16" BorderBrush="#E0E0E0" BorderThickness="1" Margin="0,0,10,0">
          <StackPanel Spacing="12">
            <TextBlock Text="表达式描述" FontWeight="Bold" FontSize="16"/>
            <TextBlock Text="{Binding Description}" 
                       TextWrapping="Wrap"
                       IsVisible="{Binding Description, Converter={x:Static converters:StringConverters.IsNotNullOrEmpty}}"/>
            <TextBlock Text="暂无描述" 
                       Foreground="Gray"
                       IsVisible="{Binding Description, Converter={x:Static converters:StringConverters.IsNullOrEmpty}}"/>
          </StackPanel>
        </Border>
        
        <!-- Next Executions -->
        <Border Grid.Column="1" Background="White" CornerRadius="8" Padding="16" BorderBrush="#E0E0E0" BorderThickness="1" Margin="10,0,0,0">
          <StackPanel Spacing="12">
            <TextBlock Text="执行时间预览" FontWeight="Bold" FontSize="16"/>
            <ScrollViewer MaxHeight="200">
              <TextBlock Text="{Binding NextExecutions}" 
                         TextWrapping="Wrap"
                         FontFamily="Consolas,Monaco,monospace"
                         FontSize="12"
                         IsVisible="{Binding NextExecutions, Converter={x:Static converters:StringConverters.IsNotNullOrEmpty}}"/>
            </ScrollViewer>
            <TextBlock Text="暂无执行时间信息" 
                       Foreground="Gray"
                       IsVisible="{Binding NextExecutions, Converter={x:Static converters:StringConverters.IsNullOrEmpty}}"/>
          </StackPanel>
        </Border>
      </Grid>

      <!-- Help Information -->
      <Border Background="#F8F9FA" CornerRadius="8" Padding="16" BorderBrush="#E9ECEF" BorderThickness="1">
        <StackPanel Spacing="12">
          <TextBlock Text="Cron表达式格式说明" FontWeight="Bold" FontSize="16"/>
          <TextBlock TextWrapping="Wrap">
            <Run Text="Cron表达式由6个字段组成："/>
            <Run Text="秒 分 时 日 月 周" FontWeight="Bold" FontFamily="Consolas"/>
          </TextBlock>
          <Grid>
            <Grid.ColumnDefinitions>
              <ColumnDefinition Width="Auto"/>
              <ColumnDefinition Width="*"/>
            </Grid.ColumnDefinitions>
            <Grid.RowDefinitions>
              <RowDefinition Height="Auto"/>
              <RowDefinition Height="Auto"/>
              <RowDefinition Height="Auto"/>
              <RowDefinition Height="Auto"/>
              <RowDefinition Height="Auto"/>
            </Grid.RowDefinitions>
            
            <TextBlock Grid.Row="0" Grid.Column="0" Text="*" FontFamily="Consolas" FontWeight="Bold" Margin="0,0,12,0"/>
            <TextBlock Grid.Row="0" Grid.Column="1" Text="匹配任意值"/>
            
            <TextBlock Grid.Row="1" Grid.Column="0" Text="?" FontFamily="Consolas" FontWeight="Bold" Margin="0,0,12,0"/>
            <TextBlock Grid.Row="1" Grid.Column="1" Text="不指定值（仅用于日和周字段）"/>
            
            <TextBlock Grid.Row="2" Grid.Column="0" Text="," FontFamily="Consolas" FontWeight="Bold" Margin="0,0,12,0"/>
            <TextBlock Grid.Row="2" Grid.Column="1" Text="分隔多个值，如：1,3,5"/>
            
            <TextBlock Grid.Row="3" Grid.Column="0" Text="-" FontFamily="Consolas" FontWeight="Bold" Margin="0,0,12,0"/>
            <TextBlock Grid.Row="3" Grid.Column="1" Text="指定范围，如：1-5"/>
            
            <TextBlock Grid.Row="4" Grid.Column="0" Text="/" FontFamily="Consolas" FontWeight="Bold" Margin="0,0,12,0"/>
            <TextBlock Grid.Row="4" Grid.Column="1" Text="指定间隔，如：*/5（每5个单位）"/>
          </Grid>
        </StackPanel>
      </Border>
      
    </StackPanel>
  </ScrollViewer>
</UserControl>