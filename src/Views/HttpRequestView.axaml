<UserControl xmlns="https://github.com/avaloniaui"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
             xmlns:vm="using:DevUtilities.ViewModels"
             mc:Ignorable="d" d:DesignWidth="800" d:DesignHeight="450"
             x:Class="DevUtilities.Views.HttpRequestView"
             x:DataType="vm:HttpRequestViewModel">
  <ScrollViewer VerticalAlignment="Stretch" HorizontalAlignment="Stretch" VerticalScrollBarVisibility="Auto" HorizontalScrollBarVisibility="Auto">
    <StackPanel Margin="20" Spacing="20">
      <!-- 标题 -->
      <TextBlock Text="HTTP请求工具" 
                 FontSize="24" 
                 FontWeight="Bold" 
                 HorizontalAlignment="Center"/>
      
      <TextBlock Text="发送HTTP请求并查看响应结果" 
                 FontSize="14" 
                 HorizontalAlignment="Center"
                 Foreground="Gray" 
                 Margin="0,0,0,16"/>

      <!-- 请求配置 -->
      <Border Background="White" CornerRadius="8" Padding="16" BorderBrush="#E0E0E0" BorderThickness="1">
        <StackPanel Spacing="16">
          <TextBlock Text="请求配置" FontWeight="Bold" FontSize="16"/>
          
          <!-- URL和方法 -->
          <Grid>
            <Grid.ColumnDefinitions>
              <ColumnDefinition Width="Auto"/>
              <ColumnDefinition Width="*"/>
              <ColumnDefinition Width="Auto"/>
            </Grid.ColumnDefinitions>
            
            <ComboBox Grid.Column="0" 
                      SelectedItem="{Binding SelectedMethod}"
                      Width="100"
                      Margin="0,0,8,0">
              <ComboBoxItem Content="GET"/>
              <ComboBoxItem Content="POST"/>
              <ComboBoxItem Content="PUT"/>
              <ComboBoxItem Content="DELETE"/>
            </ComboBox>
            
            <TextBox Grid.Column="1" 
                     Text="{Binding Url}" 
                     Watermark="输入请求URL"
                     Margin="0,0,8,0"/>
            
            <Button Grid.Column="2" 
                    Content="发送"
                    Command="{Binding SendRequestCommand}"
                    IsEnabled="{Binding !IsLoading}"
                    Width="80"/>
          </Grid>
          
          <!-- 请求选项 -->
          <Grid>
            <Grid.ColumnDefinitions>
              <ColumnDefinition Width="*"/>
              <ColumnDefinition Width="*"/>
              <ColumnDefinition Width="*"/>
            </Grid.ColumnDefinitions>
            
            <StackPanel Grid.Column="0" Spacing="8" Margin="0,0,16,0">
              <TextBlock Text="超时设置" FontWeight="SemiBold"/>
              <NumericUpDown Value="30" 
                             Minimum="1" 
                             Maximum="300" 
                             Increment="1"
                             FormatString="0 秒"/>
            </StackPanel>
            
            <StackPanel Grid.Column="1" Spacing="8" Margin="0,0,16,0">
              <TextBlock Text="内容类型" FontWeight="SemiBold"/>
              <ComboBox SelectedItem="application/json"
                        Width="200">
                <ComboBoxItem Content="application/json"/>
                <ComboBoxItem Content="application/xml"/>
                <ComboBoxItem Content="text/plain"/>
              </ComboBox>
            </StackPanel>
            
            <StackPanel Grid.Column="2" Spacing="8">
              <TextBlock Text="选项" FontWeight="SemiBold"/>
              <CheckBox Content="跟随重定向" IsChecked="True"/>
              <CheckBox Content="验证SSL证书" IsChecked="True"/>
            </StackPanel>
          </Grid>
        </StackPanel>
      </Border>

      <!-- 请求头 -->
      <Border Background="White" CornerRadius="8" Padding="16" BorderBrush="#E0E0E0" BorderThickness="1">
        <StackPanel Spacing="12">
          <StackPanel Orientation="Horizontal" Spacing="8">
            <TextBlock Text="请求头" FontWeight="Bold" FontSize="16"/>
            <Button Content="添加" Command="{Binding AddHeaderCommand}" FontSize="12"/>
            <Button Content="清空" Command="{Binding ClearAllCommand}" FontSize="12"/>
            <Button Content="导入" Command="{Binding LoadExampleCommand}" FontSize="12"/>
          </StackPanel>
          
          <DataGrid ItemsSource="{Binding RequestHeaders}" 
                    Height="150"
                    CanUserReorderColumns="True"
                    CanUserResizeColumns="True"
                    GridLinesVisibility="All"
                    BorderThickness="1"
                    BorderBrush="#E0E0E0">
            <DataGrid.Columns>
              <DataGridTextColumn Header="名称" Binding="{Binding Name}" Width="200"/>
              <DataGridTextColumn Header="值" Binding="{Binding Value}" Width="*"/>
              <DataGridTemplateColumn Header="操作" Width="80">
                <DataGridTemplateColumn.CellTemplate>
                  <DataTemplate>
                    <Button Content="删除" 
                            Command="{Binding $parent[UserControl].DataContext.RemoveHeaderCommand}"
                            CommandParameter="{Binding}"
                            FontSize="10"/>
                  </DataTemplate>
                </DataGridTemplateColumn.CellTemplate>
              </DataGridTemplateColumn>
            </DataGrid.Columns>
          </DataGrid>
          
          <!-- 常用请求头快捷按钮 -->
          <WrapPanel>
            <Button Content="Authorization" Command="{Binding AddHeaderCommand}" CommandParameter="Authorization" Margin="2"/>
            <Button Content="Content-Type" Command="{Binding AddHeaderCommand}" CommandParameter="Content-Type" Margin="2"/>
            <Button Content="Accept" Command="{Binding AddHeaderCommand}" CommandParameter="Accept" Margin="2"/>
            <Button Content="User-Agent" Command="{Binding AddHeaderCommand}" CommandParameter="User-Agent" Margin="2"/>
            <Button Content="Cache-Control" Command="{Binding AddHeaderCommand}" CommandParameter="Cache-Control" Margin="2"/>
          </WrapPanel>
        </StackPanel>
      </Border>

      <!-- 请求体 -->
      <Border Background="White" CornerRadius="8" Padding="16" BorderBrush="#E0E0E0" BorderThickness="1">
        <StackPanel Spacing="12">
          <StackPanel Orientation="Horizontal" Spacing="8">
            <TextBlock Text="请求体" FontWeight="Bold" FontSize="16"/>
            <Button Content="格式化JSON" Command="{Binding FormatJsonCommand}"/>
            <Button Content="从文件加载" Command="{Binding LoadExampleCommand}"/>
            <Button Content="清空" Command="{Binding ClearAllCommand}"/>
          </StackPanel>
          
          <TextBox Text="{Binding RequestBody}" 
                   AcceptsReturn="True" 
                   TextWrapping="Wrap" 
                   Height="200" 
                   ScrollViewer.VerticalScrollBarVisibility="Auto"
                   FontFamily="Consolas"
                   Watermark="输入请求体内容（JSON、XML、表单数据等）" />
          
          <!-- 请求体模板 -->
          <StackPanel Orientation="Horizontal" Spacing="8">
            <TextBlock Text="模板：" VerticalAlignment="Center"/>
            <Button Content="JSON对象" Command="{Binding LoadExampleCommand}" CommandParameter="json_object"/>
            <Button Content="JSON数组" Command="{Binding LoadPostExampleCommand}" CommandParameter="json_array"/>
            <Button Content="表单数据" Command="{Binding FormatJsonCommand}" CommandParameter="form_data"/>
            <Button Content="XML" Command="{Binding ClearAllCommand}" CommandParameter="xml"/>
          </StackPanel>
        </StackPanel>
      </Border>

      <!-- 响应区域 -->
      <Border Background="White" CornerRadius="8" Padding="16" BorderBrush="#E0E0E0" BorderThickness="1">
        <StackPanel Spacing="16">
          <TextBlock Text="响应结果" FontWeight="Bold" FontSize="16"/>
          
          <!-- 响应状态 -->
          <Grid>
            <Grid.ColumnDefinitions>
              <ColumnDefinition Width="*"/>
              <ColumnDefinition Width="*"/>
              <ColumnDefinition Width="*"/>
              <ColumnDefinition Width="*"/>
            </Grid.ColumnDefinitions>
            
            <StackPanel Grid.Column="0" Spacing="4">
              <TextBlock Text="状态码" FontWeight="SemiBold" FontSize="12"/>
              <TextBlock Text="{Binding StatusCode}" 
                         FontSize="14" 
                         FontWeight="Bold"
                         Foreground="Blue"/>
            </StackPanel>
            
            <StackPanel Grid.Column="1" Spacing="4">
              <TextBlock Text="响应时间" FontWeight="SemiBold" FontSize="12"/>
              <TextBlock Text="{Binding ResponseTime}" FontSize="14"/>
            </StackPanel>
            
            <StackPanel Grid.Column="2" Spacing="4">
              <TextBlock Text="响应大小" FontWeight="SemiBold" FontSize="12"/>
              <TextBlock Text="未知" FontSize="14"/>
            </StackPanel>
            
            <StackPanel Grid.Column="3" Spacing="4" HorizontalAlignment="Right">
              <Button Content="保存响应" Command="{Binding ClearAllCommand}"/>
            </StackPanel>
          </Grid>
          
          <!-- 响应选项卡 -->
          <TabControl>
            <TabItem Header="响应体">
              <StackPanel Spacing="8">
                <StackPanel Orientation="Horizontal" Spacing="8">
                  <Button Content="格式化JSON" Command="{Binding FormatJsonCommand}"/>
                  <Button Content="格式化XML" Command="{Binding LoadExampleCommand}"/>
                  <Button Content="复制响应" Command="{Binding ClearAllCommand}"/>
                    <ComboBox SelectedItem="文本"
                              Width="120">
                      <ComboBoxItem Content="文本"/>
                      <ComboBoxItem Content="JSON"/>
                      <ComboBoxItem Content="XML"/>
                    </ComboBox>
                </StackPanel>
                
                <TextBox Text="响应内容将在这里显示" 
                           IsReadOnly="True"
                           AcceptsReturn="True" 
                           TextWrapping="Wrap" 
                           Height="300" 
                           ScrollViewer.VerticalScrollBarVisibility="Auto"
                           FontFamily="Consolas"
                           Background="#F8F9FA" />
              </StackPanel>
            </TabItem>
            
            <TabItem Header="响应头">
              <TextBox Text="响应头将在这里显示" 
                       IsReadOnly="True"
                       AcceptsReturn="True" 
                       TextWrapping="Wrap" 
                       Height="300" 
                       ScrollViewer.VerticalScrollBarVisibility="Auto"
                       FontFamily="Consolas"
                       Background="#F8F9FA" />
            </TabItem>
            
            <TabItem Header="Cookies">
              <DataGrid ItemsSource="{Binding RequestHeaders}" 
                        Height="300"
                        IsReadOnly="True"
                        GridLinesVisibility="All"
                        BorderThickness="1"
                        BorderBrush="#E0E0E0">
                <DataGrid.Columns>
                  <DataGridTextColumn Header="名称" Binding="{Binding Name}" Width="150"/>
                  <DataGridTextColumn Header="值" Binding="{Binding Value}" Width="*"/>
                </DataGrid.Columns>
              </DataGrid>
            </TabItem>
          </TabControl>
        </StackPanel>
      </Border>

      <!-- 历史记录 -->
      <Border Background="White" CornerRadius="8" Padding="16" BorderBrush="#E0E0E0" BorderThickness="1">
        <StackPanel Spacing="16">
          <StackPanel Orientation="Horizontal" Spacing="8">
            <TextBlock Text="请求历史" FontWeight="Bold" FontSize="16"/>
            <Button Content="清空历史" Command="{Binding ClearAllCommand}"/>
            <Button Content="导出历史" Command="{Binding FormatJsonCommand}"/>
          </StackPanel>
          
          <DataGrid ItemsSource="{Binding RequestHeaders}" 
                    Height="200"
                    CanUserReorderColumns="True"
                    CanUserResizeColumns="True"
                    GridLinesVisibility="All"
                    BorderThickness="1"
                    BorderBrush="#E0E0E0"
                    SelectedItem="{Binding Url}">
            <DataGrid.Columns>
              <DataGridTextColumn Header="名称" Binding="{Binding Name}" Width="150"/>
              <DataGridTextColumn Header="值" Binding="{Binding Value}" Width="*"/>
            </DataGrid.Columns>
          </DataGrid>
        </StackPanel>
      </Border>

      <!-- 错误信息 -->
      <Border Background="#FFEBEE" 
              CornerRadius="8" 
              Padding="16" 
              BorderBrush="#F44336" 
              BorderThickness="1"
              IsVisible="{Binding HasError}">
        <StackPanel Spacing="8">
          <TextBlock Text="错误信息" FontWeight="Bold" Foreground="#D32F2F"/>
          <TextBlock Text="{Binding ErrorMessage}" 
                     TextWrapping="Wrap" 
                     Foreground="#D32F2F"/>
        </StackPanel>
      </Border>

      <!-- 使用说明 -->
      <Expander Header="使用说明" IsExpanded="False">
        <StackPanel Spacing="12" Margin="10">
          <TextBlock Text="基本功能" FontWeight="SemiBold"/>
          <StackPanel Spacing="4" Margin="10,0">
            <TextBlock Text="• 支持GET、POST、PUT、DELETE、PATCH等HTTP方法"/>
            <TextBlock Text="• 自定义请求头和请求体"/>
            <TextBlock Text="• 查看详细的响应信息包括状态码、响应头、响应体"/>
            <TextBlock Text="• 支持JSON、XML等多种数据格式"/>
            <TextBlock Text="• 请求历史记录和重发功能"/>
          </StackPanel>
          
          <TextBlock Text="高级功能" FontWeight="SemiBold" Margin="0,10,0,0"/>
          <StackPanel Spacing="4" Margin="10,0">
            <TextBlock Text="• 自动格式化JSON和XML响应"/>
            <TextBlock Text="• Cookie管理和查看"/>
            <TextBlock Text="• 请求模板和快捷操作"/>
            <TextBlock Text="• 响应时间和大小统计"/>
            <TextBlock Text="• 导入导出请求配置"/>
          </StackPanel>
          
          <TextBlock Text="使用提示" FontWeight="SemiBold" Margin="0,10,0,0"/>
          <StackPanel Spacing="4" Margin="10,0">
            <TextBlock Text="• 可以保存常用的API请求配置"/>
            <TextBlock Text="• 支持环境变量和动态参数"/>
            <TextBlock Text="• 提供丰富的请求模板"/>
            <TextBlock Text="• 支持批量测试和性能分析"/>
          </StackPanel>
        </StackPanel>
      </Expander>
    </StackPanel>
  </ScrollViewer>
</UserControl>