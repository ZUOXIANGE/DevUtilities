<UserControl xmlns="https://github.com/avaloniaui"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:vm="using:DevUtilities.ViewModels"
             x:Class="DevUtilities.Views.ParquetViewerView"
             x:DataType="vm:ParquetViewerViewModel">

  <Design.DataContext>
    <vm:ParquetViewerViewModel/>
  </Design.DataContext>

  <ScrollViewer>
    <StackPanel Margin="20" Spacing="20">
      
      <!-- 标题区域 -->
      <StackPanel Spacing="6">
        <SelectableTextBlock Text="Parquet文件查看器" 
                   FontSize="26" 
                   FontWeight="Bold" 
                   Foreground="{DynamicResource SystemAccentColor}"/>
        <SelectableTextBlock Text="Apache Parquet文件数据查看和分析工具" 
                   FontSize="14" 
                   Foreground="{DynamicResource SystemControlForegroundBaseMediumBrush}"/>
      </StackPanel>

      <!-- 文件选择区域 -->
      <Border Background="{DynamicResource SystemControlBackgroundAltHighBrush}" 
              CornerRadius="8" 
              Padding="16">
        <StackPanel Spacing="12">
          <SelectableTextBlock Text="文件选择" FontWeight="SemiBold" FontSize="16"/>
          
          <Grid ColumnDefinitions="*,Auto" RowDefinitions="Auto,Auto,Auto">
            
            <!-- 文件路径输入 -->
            <TextBox Grid.Column="0" Grid.Row="0"
                    Text="{Binding FilePath}" 
                    Watermark="选择或输入Parquet文件路径..."
                    Margin="0,0,8,0"/>
            
            <Button Grid.Column="1" Grid.Row="0"
                   Content="浏览文件" 
                   Command="{Binding OpenFileCommand}"/>
            
            <!-- 文件信息 -->
            <StackPanel Grid.Column="0" Grid.ColumnSpan="2" Grid.Row="1" 
                       Orientation="Horizontal" 
                       Spacing="20" 
                       Margin="0,8,0,0"
                       IsVisible="{Binding IsFileLoaded}">
              <SelectableTextBlock Text="{Binding FileName, StringFormat='文件名: {0}'}" FontWeight="SemiBold"/>
              <SelectableTextBlock Text="{Binding FileSizeText, StringFormat='大小: {0}'}"/>
              <SelectableTextBlock Text="{Binding TotalRows, StringFormat='行数: {0:N0}'}"/>
              <SelectableTextBlock Text="{Binding TotalColumns, StringFormat='列数: {0}'}"/>
            </StackPanel>
            
            <!-- 操作按钮 -->
            <StackPanel Grid.Column="0" Grid.ColumnSpan="2" Grid.Row="2" 
                       Orientation="Horizontal" 
                       Spacing="8" 
                       Margin="0,8,0,0">
              <Button Content="加载文件" Command="{Binding OpenFileCommand}" Classes="accent"/>
              <Button Content="刷新" Command="{Binding RefreshCommand}" IsEnabled="{Binding IsFileLoaded}"/>
              <Button Content="导出CSV" Command="{Binding ExportCsvCommand}" IsEnabled="{Binding IsFileLoaded}"/>
              <Button Content="导出JSON" Command="{Binding ExportJsonCommand}" IsEnabled="{Binding IsFileLoaded}"/>
              <Button Content="清空" Command="{Binding CloseFileCommand}"/>
            </StackPanel>
          </Grid>
        </StackPanel>
      </Border>

      <!-- 加载指示器 -->
      <Border Background="{DynamicResource SystemControlBackgroundAltHighBrush}" 
              CornerRadius="8" 
              Padding="20"
              IsVisible="{Binding IsLoading}">
        <StackPanel Orientation="Horizontal" Spacing="12" HorizontalAlignment="Center">
          <Border Width="24" Height="24" CornerRadius="12" Background="{DynamicResource SystemAccentColor}">
            <SelectableTextBlock Text="●" HorizontalAlignment="Center" VerticalAlignment="Center" Foreground="White"/>
          </Border>
          <SelectableTextBlock Text="正在加载Parquet文件..." VerticalAlignment="Center"/>
        </StackPanel>
      </Border>

      <!-- 错误消息 -->
      <Border Background="{DynamicResource SystemControlBackgroundAltHighBrush}" 
              CornerRadius="8" 
              Padding="12"
              BorderBrush="Red"
              BorderThickness="1"
              IsVisible="{Binding HasError}">
        <StackPanel Spacing="8">
          <SelectableTextBlock Text="错误信息" FontWeight="SemiBold" Foreground="Red"/>
          <TextBox Text="{Binding ErrorMessage}" 
                  IsReadOnly="True" 
                  Background="Transparent"
                  BorderThickness="0"
                  TextWrapping="Wrap"
                  Foreground="Red"/>
        </StackPanel>
      </Border>

      <!-- 数据查看区域 -->
      <Border Background="{DynamicResource SystemControlBackgroundAltHighBrush}" 
              CornerRadius="8" 
              Padding="16"
              IsVisible="{Binding IsFileLoaded}">
        <StackPanel Spacing="12">
          <SelectableTextBlock Text="数据查看" FontWeight="SemiBold" FontSize="16"/>
          
          <!-- 分页控制 -->
          <Grid ColumnDefinitions="Auto,*,Auto,Auto,Auto,Auto,Auto">
            <SelectableTextBlock Grid.Column="0" Text="页码:" VerticalAlignment="Center" Margin="0,0,8,0"/>
            <TextBox Grid.Column="1" Text="{Binding CurrentPage}" Width="80" Margin="0,0,8,0"/>
            <SelectableTextBlock Grid.Column="2" Text="{Binding TotalPages, StringFormat='/ {0}'}" VerticalAlignment="Center" Margin="0,0,16,0"/>
            
            <Button Grid.Column="3" Content="首页" Command="{Binding FirstPageCommand}" Margin="0,0,4,0"/>
            <Button Grid.Column="4" Content="上一页" Command="{Binding PreviousPageCommand}" Margin="0,0,4,0"/>
            <Button Grid.Column="5" Content="下一页" Command="{Binding NextPageCommand}" Margin="0,0,4,0"/>
            <Button Grid.Column="6" Content="末页" Command="{Binding LastPageCommand}"/>
          </Grid>
          
          <!-- 每页行数设置 -->
          <StackPanel Orientation="Horizontal" Spacing="8">
            <SelectableTextBlock Text="每页显示:" VerticalAlignment="Center"/>
            <ComboBox SelectedItem="{Binding PageSize}" Width="80">
              <ComboBoxItem Content="50"/>
              <ComboBoxItem Content="100"/>
              <ComboBoxItem Content="200"/>
              <ComboBoxItem Content="500"/>
              <ComboBoxItem Content="1000"/>
            </ComboBox>
            <SelectableTextBlock Text="行" VerticalAlignment="Center"/>
          </StackPanel>
          
          <!-- 数据表格 -->
          <Border Background="{DynamicResource SystemControlBackgroundBaseLowBrush}" 
                  CornerRadius="6" 
                  Padding="8"
                  MinHeight="400">
            <DataGrid ItemsSource="{Binding Data}"
                     AutoGenerateColumns="True"
                     IsReadOnly="True"
                     GridLinesVisibility="All"
                     HeadersVisibility="Column"
                     CanUserReorderColumns="True"
                     CanUserResizeColumns="True"
                     CanUserSortColumns="True"
                     SelectionMode="Extended"
                     Background="{DynamicResource SystemControlBackgroundBaseLowBrush}"
                     BorderBrush="{DynamicResource SystemControlForegroundBaseMediumLowBrush}"
                     BorderThickness="1"
                     CornerRadius="4"
                     MinHeight="300">
              <DataGrid.Styles>
                <Style Selector="DataGridColumnHeader">
                  <Setter Property="Background" Value="{DynamicResource SystemControlBackgroundAltMediumBrush}"/>
                  <Setter Property="FontWeight" Value="SemiBold"/>
                  <Setter Property="Padding" Value="8,4"/>
                </Style>
                <Style Selector="DataGridRow:nth-child(even)">
                  <Setter Property="Background" Value="{DynamicResource SystemControlBackgroundAltLowBrush}"/>
                </Style>
                <Style Selector="DataGridCell">
                  <Setter Property="Padding" Value="8,4"/>
                </Style>
              </DataGrid.Styles>
            </DataGrid>
          </Border>
        </StackPanel>
      </Border>

      <!-- 数据统计区域 -->
      <Border Background="{DynamicResource SystemControlBackgroundAltHighBrush}" 
              CornerRadius="8" 
              Padding="16"
              IsVisible="{Binding IsFileLoaded}">
        <StackPanel Spacing="12">
          <SelectableTextBlock Text="数据统计" FontWeight="SemiBold" FontSize="16"/>
          
          <Grid ColumnDefinitions="*,*,*,*" RowDefinitions="Auto,Auto">
            
            <!-- 基本统计 -->
            <StackPanel Grid.Column="0" Grid.Row="0" Spacing="4">
              <SelectableTextBlock Text="基本信息" FontWeight="SemiBold"/>
              <SelectableTextBlock Text="{Binding TotalRows, StringFormat='总行数: {0:N0}'}"/>
              <SelectableTextBlock Text="{Binding TotalColumns, StringFormat='总列数: {0}'}"/>
              <SelectableTextBlock Text="{Binding FileSizeText, StringFormat='文件大小: {0}'}"/>
            </StackPanel>
            
            <!-- 列信息 -->
            <StackPanel Grid.Column="1" Grid.Row="0" Spacing="4">
              <SelectableTextBlock Text="列信息" FontWeight="SemiBold"/>
              <SelectableTextBlock Text="{Binding TotalColumns, StringFormat='总列数: {0}'}" TextWrapping="Wrap"/>
            </StackPanel>
            
            <!-- 数据类型 -->
            <StackPanel Grid.Column="2" Grid.Row="0" Spacing="4">
              <SelectableTextBlock Text="数据类型" FontWeight="SemiBold"/>
              <SelectableTextBlock Text="{Binding ColumnNames.Count, StringFormat='列名数量: {0}'}" TextWrapping="Wrap"/>
            </StackPanel>
            
            <!-- 压缩信息 -->
            <StackPanel Grid.Column="3" Grid.Row="0" Spacing="4">
              <SelectableTextBlock Text="压缩信息" FontWeight="SemiBold"/>
              <SelectableTextBlock Text="{Binding TotalRows, StringFormat='总行数: {0}'}" TextWrapping="Wrap"/>
            </StackPanel>
          </Grid>
        </StackPanel>
      </Border>

      <!-- 工具区域 -->
      <Border Background="{DynamicResource SystemControlBackgroundAltHighBrush}" 
              CornerRadius="8" 
              Padding="16">
        <StackPanel Spacing="12">
          <SelectableTextBlock Text="数据工具" FontWeight="SemiBold" FontSize="16"/>
          
          <WrapPanel Orientation="Horizontal" ItemWidth="160" ItemHeight="40">
            <Button Content="查看架构" Command="{Binding OpenFileCommand}" 
                   HorizontalAlignment="Stretch" Margin="4"/>
            <Button Content="数据预览" Command="{Binding RefreshCommand}" 
                   HorizontalAlignment="Stretch" Margin="4"/>
            <Button Content="列统计" Command="{Binding SearchCommand}" 
                   HorizontalAlignment="Stretch" Margin="4"/>
            <Button Content="数据筛选" Command="{Binding ClearSearchCommand}" 
                   HorizontalAlignment="Stretch" Margin="4"/>
            <Button Content="数据搜索" Command="{Binding SearchCommand}" 
                   HorizontalAlignment="Stretch" Margin="4"/>
            <Button Content="导出选中" Command="{Binding ExportCsvCommand}" 
                   HorizontalAlignment="Stretch" Margin="4"/>
            <Button Content="比较文件" Command="{Binding ExportJsonCommand}" 
                   HorizontalAlignment="Stretch" Margin="4"/>
            <Button Content="生成报告" Command="{Binding CloseFileCommand}" 
                   HorizontalAlignment="Stretch" Margin="4"/>
          </WrapPanel>
        </StackPanel>
      </Border>

      <!-- 使用说明 -->
      <Expander Header="使用说明" IsExpanded="False">
        <Border Background="{DynamicResource SystemControlBackgroundAltHighBrush}" 
                CornerRadius="8" 
                Padding="16">
          <StackPanel Spacing="8">
            <SelectableTextBlock Text="文件加载：" FontWeight="SemiBold"/>
            <SelectableTextBlock Text="• 点击'浏览文件'选择Parquet文件" TextWrapping="Wrap"/>
            <SelectableTextBlock Text="• 或直接在文本框中输入文件路径" TextWrapping="Wrap"/>
            <SelectableTextBlock Text="• 支持本地文件和网络文件" TextWrapping="Wrap"/>
            
            <SelectableTextBlock Text="数据查看：" FontWeight="SemiBold" Margin="0,12,0,0"/>
            <SelectableTextBlock Text="• 使用分页控制浏览大型数据集" TextWrapping="Wrap"/>
            <SelectableTextBlock Text="• 可调整每页显示的行数" TextWrapping="Wrap"/>
            <SelectableTextBlock Text="• 支持列排序和筛选" TextWrapping="Wrap"/>
            
            <SelectableTextBlock Text="数据导出：" FontWeight="SemiBold" Margin="0,12,0,0"/>
            <SelectableTextBlock Text="• 支持导出为CSV和JSON格式" TextWrapping="Wrap"/>
            <SelectableTextBlock Text="• 可导出全部数据或选中数据" TextWrapping="Wrap"/>
            <SelectableTextBlock Text="• 保持原始数据类型和格式" TextWrapping="Wrap"/>
          </StackPanel>
        </Border>
      </Expander>

    </StackPanel>
  </ScrollViewer>
</UserControl>

