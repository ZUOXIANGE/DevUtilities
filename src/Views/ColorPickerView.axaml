<UserControl xmlns="https://github.com/avaloniaui"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
             xmlns:vm="using:DevUtilities.ViewModels"
             mc:Ignorable="d" d:DesignWidth="1000" d:DesignHeight="600"
             x:Class="DevUtilities.Views.ColorPickerView"
             x:DataType="vm:ColorPickerViewModel">
  <ScrollViewer VerticalAlignment="Stretch" HorizontalAlignment="Stretch" VerticalScrollBarVisibility="Auto" HorizontalScrollBarVisibility="Auto">
    <Grid Margin="20" RowDefinitions="Auto,Auto,*" ColumnDefinitions="2*,*" ColumnSpacing="20" RowSpacing="20">
      
      <!-- 标题 -->
      <TextBlock Grid.Row="0" Grid.ColumnSpan="2" 
                 Text="颜色选择器" 
                 FontSize="24" 
                 FontWeight="Bold" 
                 HorizontalAlignment="Center"/>

      <!-- 错误信息 -->
      <Border Grid.Row="1" Grid.ColumnSpan="2" 
              Background="#FFEBEE" CornerRadius="4" Padding="12" 
              IsVisible="{Binding HasError}">
        <TextBlock Text="{Binding ErrorMessage}" 
                   Foreground="#C62828" 
                   TextWrapping="Wrap"/>
      </Border>

      <!-- 左侧：主要颜色显示和控制区域 -->
      <StackPanel Grid.Row="2" Grid.Column="0" Spacing="20">
        
        <!-- 颜色预览区域 -->
        <Border Background="White" CornerRadius="12" Padding="20" 
                BorderBrush="#E0E0E0" BorderThickness="1">
          <Grid RowDefinitions="Auto,Auto,Auto" RowSpacing="15">
            
            <!-- 大颜色预览 -->
            <Border Grid.Row="0" Height="120" CornerRadius="12" 
                    Background="{Binding HexColor}" 
                    BorderBrush="#CCCCCC" BorderThickness="1">
              <Border.Effect>
                <DropShadowEffect BlurRadius="8" OffsetX="0" OffsetY="2" Opacity="0.1"/>
              </Border.Effect>
            </Border>
            
            <!-- 操作按钮 -->
            <UniformGrid Grid.Row="1" Columns="2" ColumnSpacing="10">
              <Button Content="🎲 随机颜色" 
                      Command="{Binding RandomColorCommand}"
                      HorizontalAlignment="Stretch"
                      Padding="12,8"/>
              <Button Content="📌 添加到历史" 
                      Command="{Binding AddToHistoryCommand}"
                      HorizontalAlignment="Stretch"
                      Padding="12,8"/>
            </UniformGrid>
            
            <!-- 颜色名称显示 -->
            <TextBlock Grid.Row="2" 
                       Text="{Binding ColorName}" 
                       FontSize="16" 
                       FontWeight="SemiBold"
                       HorizontalAlignment="Center"
                       Foreground="#666666"/>
          </Grid>
        </Border>

        <!-- RGB 控制 -->
        <Border Background="White" CornerRadius="8" Padding="16" 
                BorderBrush="#E0E0E0" BorderThickness="1">
          <StackPanel Spacing="12">
            <TextBlock Text="RGB 控制" FontSize="16" FontWeight="SemiBold" Foreground="#333333"/>
            
            <!-- Red -->
            <Grid ColumnDefinitions="40,*,70" ColumnSpacing="10">
              <TextBlock Grid.Column="0" Text="R" VerticalAlignment="Center" 
                         FontWeight="SemiBold" Foreground="#E53E3E"/>
              <Slider Grid.Column="1" Minimum="0" Maximum="255" 
                      Value="{Binding Red}" 
                      TickFrequency="1" IsSnapToTickEnabled="True"/>
              <TextBox Grid.Column="2" Text="{Binding Red}" 
                       HorizontalAlignment="Stretch" TextAlignment="Center"/>
            </Grid>
            
            <!-- Green -->
            <Grid ColumnDefinitions="40,*,70" ColumnSpacing="10">
              <TextBlock Grid.Column="0" Text="G" VerticalAlignment="Center" 
                         FontWeight="SemiBold" Foreground="#38A169"/>
              <Slider Grid.Column="1" Minimum="0" Maximum="255" 
                      Value="{Binding Green}" 
                      TickFrequency="1" IsSnapToTickEnabled="True"/>
              <TextBox Grid.Column="2" Text="{Binding Green}" 
                       HorizontalAlignment="Stretch" TextAlignment="Center"/>
            </Grid>
            
            <!-- Blue -->
            <Grid ColumnDefinitions="40,*,70" ColumnSpacing="10">
              <TextBlock Grid.Column="0" Text="B" VerticalAlignment="Center" 
                         FontWeight="SemiBold" Foreground="#3182CE"/>
              <Slider Grid.Column="1" Minimum="0" Maximum="255" 
                      Value="{Binding Blue}" 
                      TickFrequency="1" IsSnapToTickEnabled="True"/>
              <TextBox Grid.Column="2" Text="{Binding Blue}" 
                       HorizontalAlignment="Stretch" TextAlignment="Center"/>
            </Grid>
          </StackPanel>
        </Border>

        <!-- HSL 控制 -->
        <Border Background="White" CornerRadius="8" Padding="16" 
                BorderBrush="#E0E0E0" BorderThickness="1">
          <StackPanel Spacing="12">
            <TextBlock Text="HSL 控制" FontSize="16" FontWeight="SemiBold" Foreground="#333333"/>
            
            <!-- Hue -->
            <Grid ColumnDefinitions="40,*,70" ColumnSpacing="10">
              <TextBlock Grid.Column="0" Text="H" VerticalAlignment="Center" 
                         FontWeight="SemiBold" Foreground="#9F7AEA"/>
              <Slider Grid.Column="1" Minimum="0" Maximum="360" 
                      Value="{Binding Hue}" 
                      TickFrequency="1" IsSnapToTickEnabled="True"/>
              <TextBox Grid.Column="2" Text="{Binding Hue, StringFormat=F0}" 
                       HorizontalAlignment="Stretch" TextAlignment="Center"/>
            </Grid>
            
            <!-- Saturation -->
            <Grid ColumnDefinitions="40,*,70" ColumnSpacing="10">
              <TextBlock Grid.Column="0" Text="S" VerticalAlignment="Center" 
                         FontWeight="SemiBold" Foreground="#ED8936"/>
              <Slider Grid.Column="1" Minimum="0" Maximum="100" 
                      Value="{Binding Saturation}" 
                      TickFrequency="1" IsSnapToTickEnabled="True"/>
              <TextBox Grid.Column="2" Text="{Binding Saturation, StringFormat=F0}" 
                       HorizontalAlignment="Stretch" TextAlignment="Center"/>
            </Grid>
            
            <!-- Lightness -->
            <Grid ColumnDefinitions="40,*,70" ColumnSpacing="10">
              <TextBlock Grid.Column="0" Text="L" VerticalAlignment="Center" 
                         FontWeight="SemiBold" Foreground="#48BB78"/>
              <Slider Grid.Column="1" Minimum="0" Maximum="100" 
                      Value="{Binding Lightness}" 
                      TickFrequency="1" IsSnapToTickEnabled="True"/>
              <TextBox Grid.Column="2" Text="{Binding Lightness, StringFormat=F0}" 
                       HorizontalAlignment="Stretch" TextAlignment="Center"/>
            </Grid>
          </StackPanel>
        </Border>
      </StackPanel>

      <!-- 右侧：颜色代码、历史和预设 -->
      <StackPanel Grid.Row="2" Grid.Column="1" Spacing="20">
        
        <!-- 颜色代码输出 -->
        <Border Background="White" CornerRadius="8" Padding="16" 
                BorderBrush="#E0E0E0" BorderThickness="1">
          <StackPanel Spacing="12">
            <TextBlock Text="颜色代码" FontSize="16" FontWeight="SemiBold" Foreground="#333333"/>
            
            <!-- HEX -->
            <Grid ColumnDefinitions="50,*,Auto" ColumnSpacing="8">
              <TextBlock Grid.Column="0" Text="HEX" VerticalAlignment="Center" 
                         FontWeight="SemiBold" Foreground="#666666"/>
              <TextBox Grid.Column="1" Text="{Binding HexColor}" 
                       IsReadOnly="True" 
                       FontFamily="Consolas"
                       Background="#F8F9FA"/>
              <Button Grid.Column="2" Content="📋" 
                      Command="{Binding CopyColorCommand}"
                      CommandParameter="{Binding HexColor}"
                      ToolTip.Tip="复制HEX代码"
                      Padding="8"/>
            </Grid>
            
            <!-- RGB -->
            <Grid ColumnDefinitions="50,*,Auto" ColumnSpacing="8">
              <TextBlock Grid.Column="0" Text="RGB" VerticalAlignment="Center" 
                         FontWeight="SemiBold" Foreground="#666666"/>
              <TextBox Grid.Column="1" Text="{Binding RgbString}" 
                       IsReadOnly="True" 
                       FontFamily="Consolas"
                       Background="#F8F9FA"/>
              <Button Grid.Column="2" Content="📋" 
                      Command="{Binding CopyColorCommand}"
                      CommandParameter="{Binding RgbString}"
                      ToolTip.Tip="复制RGB代码"
                      Padding="8"/>
            </Grid>
            
            <!-- HSL -->
            <Grid ColumnDefinitions="50,*,Auto" ColumnSpacing="8">
              <TextBlock Grid.Column="0" Text="HSL" VerticalAlignment="Center" 
                         FontWeight="SemiBold" Foreground="#666666"/>
              <TextBox Grid.Column="1" Text="{Binding HslString}" 
                       IsReadOnly="True" 
                       FontFamily="Consolas"
                       Background="#F8F9FA"/>
              <Button Grid.Column="2" Content="📋" 
                      Command="{Binding CopyColorCommand}"
                      CommandParameter="{Binding HslString}"
                      ToolTip.Tip="复制HSL代码"
                      Padding="8"/>
            </Grid>
            
            <!-- HSV -->
            <Grid ColumnDefinitions="50,*,Auto" ColumnSpacing="8">
              <TextBlock Grid.Column="0" Text="HSV" VerticalAlignment="Center" 
                         FontWeight="SemiBold" Foreground="#666666"/>
              <TextBox Grid.Column="1" Text="{Binding HsvString}" 
                       IsReadOnly="True" 
                       FontFamily="Consolas"
                       Background="#F8F9FA"/>
              <Button Grid.Column="2" Content="📋" 
                      Command="{Binding CopyColorCommand}"
                      CommandParameter="{Binding HsvString}"
                      ToolTip.Tip="复制HSV代码"
                      Padding="8"/>
            </Grid>
            
            <!-- CMYK -->
            <Grid ColumnDefinitions="50,*,Auto" ColumnSpacing="8">
              <TextBlock Grid.Column="0" Text="CMYK" VerticalAlignment="Center" 
                         FontWeight="SemiBold" Foreground="#666666"/>
              <TextBox Grid.Column="1" Text="{Binding CmykString}" 
                       IsReadOnly="True" 
                       FontFamily="Consolas"
                       Background="#F8F9FA"/>
              <Button Grid.Column="2" Content="📋" 
                      Command="{Binding CopyColorCommand}"
                      CommandParameter="{Binding CmykString}"
                      ToolTip.Tip="复制CMYK代码"
                      Padding="8"/>
            </Grid>
          </StackPanel>
        </Border>

        <!-- 预设颜色 -->
        <Border Background="White" CornerRadius="8" Padding="16" 
                BorderBrush="#E0E0E0" BorderThickness="1">
          <StackPanel Spacing="12">
            <TextBlock Text="预设颜色" FontSize="16" FontWeight="SemiBold" Foreground="#333333"/>
            
            <!-- 基础颜色 -->
            <TextBlock Text="基础色彩" FontSize="12" Foreground="#666666" Margin="0,0,0,4"/>
            <UniformGrid Columns="4" ColumnSpacing="6" RowSpacing="6">
              <Border Width="35" Height="35" Background="Red" CornerRadius="6" Cursor="Hand"
                      ToolTip.Tip="红色" BorderBrush="#CCCCCC" BorderThickness="1"/>
              <Border Width="35" Height="35" Background="Green" CornerRadius="6" Cursor="Hand"
                      ToolTip.Tip="绿色" BorderBrush="#CCCCCC" BorderThickness="1"/>
              <Border Width="35" Height="35" Background="Blue" CornerRadius="6" Cursor="Hand"
                      ToolTip.Tip="蓝色" BorderBrush="#CCCCCC" BorderThickness="1"/>
              <Border Width="35" Height="35" Background="Yellow" CornerRadius="6" Cursor="Hand"
                      ToolTip.Tip="黄色" BorderBrush="#CCCCCC" BorderThickness="1"/>
              <Border Width="35" Height="35" Background="Cyan" CornerRadius="6" Cursor="Hand"
                      ToolTip.Tip="青色" BorderBrush="#CCCCCC" BorderThickness="1"/>
              <Border Width="35" Height="35" Background="Magenta" CornerRadius="6" Cursor="Hand"
                      ToolTip.Tip="品红" BorderBrush="#CCCCCC" BorderThickness="1"/>
              <Border Width="35" Height="35" Background="Orange" CornerRadius="6" Cursor="Hand"
                      ToolTip.Tip="橙色" BorderBrush="#CCCCCC" BorderThickness="1"/>
              <Border Width="35" Height="35" Background="Purple" CornerRadius="6" Cursor="Hand"
                      ToolTip.Tip="紫色" BorderBrush="#CCCCCC" BorderThickness="1"/>
            </UniformGrid>
            
            <!-- 灰度颜色 -->
            <TextBlock Text="灰度色彩" FontSize="12" Foreground="#666666" Margin="0,8,0,4"/>
            <UniformGrid Columns="4" ColumnSpacing="6" RowSpacing="6">
              <Border Width="35" Height="35" Background="Black" CornerRadius="6" Cursor="Hand"
                      ToolTip.Tip="黑色" BorderBrush="#CCCCCC" BorderThickness="1"/>
              <Border Width="35" Height="35" Background="#333333" CornerRadius="6" Cursor="Hand"
                      ToolTip.Tip="深灰" BorderBrush="#CCCCCC" BorderThickness="1"/>
              <Border Width="35" Height="35" Background="#666666" CornerRadius="6" Cursor="Hand"
                      ToolTip.Tip="中灰" BorderBrush="#CCCCCC" BorderThickness="1"/>
              <Border Width="35" Height="35" Background="#999999" CornerRadius="6" Cursor="Hand"
                      ToolTip.Tip="浅灰" BorderBrush="#CCCCCC" BorderThickness="1"/>
              <Border Width="35" Height="35" Background="#CCCCCC" CornerRadius="6" Cursor="Hand"
                      ToolTip.Tip="淡灰" BorderBrush="#CCCCCC" BorderThickness="1"/>
              <Border Width="35" Height="35" Background="#EEEEEE" CornerRadius="6" Cursor="Hand"
                      ToolTip.Tip="极淡灰" BorderBrush="#CCCCCC" BorderThickness="1"/>
              <Border Width="35" Height="35" Background="White" CornerRadius="6" Cursor="Hand"
                      ToolTip.Tip="白色" BorderBrush="#CCCCCC" BorderThickness="1"/>
            </UniformGrid>
          </StackPanel>
        </Border>

        <!-- 颜色历史 -->
        <Border Background="White" CornerRadius="8" Padding="16" 
                BorderBrush="#E0E0E0" BorderThickness="1">
          <StackPanel Spacing="12">
            <Grid ColumnDefinitions="*,Auto">
              <TextBlock Grid.Column="0" Text="颜色历史" FontSize="16" FontWeight="SemiBold" Foreground="#333333"/>
              <Button Grid.Column="1" Content="🗑️" 
                      Command="{Binding ClearHistoryCommand}"
                      ToolTip.Tip="清空历史"
                      Padding="6"/>
            </Grid>
            
            <ScrollViewer MaxHeight="120" VerticalScrollBarVisibility="Auto">
              <ItemsControl ItemsSource="{Binding ColorHistory}">
                <ItemsControl.ItemsPanel>
                  <ItemsPanelTemplate>
                    <UniformGrid Columns="4" ColumnSpacing="6" RowSpacing="6"/>
                  </ItemsPanelTemplate>
                </ItemsControl.ItemsPanel>
                <ItemsControl.ItemTemplate>
                  <DataTemplate>
                    <Border Width="35" Height="35" 
                            Background="{Binding}" 
                            CornerRadius="6" 
                            BorderBrush="#CCCCCC" 
                            BorderThickness="1" 
                            Cursor="Hand">
                      <Border.Styles>
                        <Style Selector="Border:pointerover">
                          <Setter Property="BorderBrush" Value="#666666"/>
                          <Setter Property="BorderThickness" Value="2"/>
                        </Style>
                      </Border.Styles>
                    </Border>
                  </DataTemplate>
                </ItemsControl.ItemTemplate>
              </ItemsControl>
            </ScrollViewer>
          </StackPanel>
        </Border>
      </StackPanel>
    </Grid>
  </ScrollViewer>
</UserControl>
